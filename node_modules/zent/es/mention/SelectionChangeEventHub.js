import isFirefox from '../utils/isFirefox';
var gEventRegistered = false;
var subscriberList = [];
export function install(config) {
    if (!gEventRegistered) {
        if (isFirefox) {
            document.addEventListener('click', onDocumentSelectionChange, true);
        }
        else {
            document.addEventListener('selectionchange', onDocumentSelectionChange);
        }
    }
    var idx = findSubscriberIndex(config);
    if (idx === -1) {
        subscriberList.push(config);
    }
}
export function uninstall(config) {
    var idx = findSubscriberIndex(config);
    if (idx === -1) {
        return;
    }
    subscriberList.splice(idx, 1);
    if (subscriberList.length === 0) {
        if (isFirefox) {
            document.removeEventListener('click', onDocumentSelectionChange, true);
        }
        else {
            document.removeEventListener('selectionchange', onDocumentSelectionChange);
        }
    }
}
function onDocumentSelectionChange(evt) {
    var activeElement = document.activeElement;
    var matchedSubscriberIndex = findSubscriberIndex({
        node: activeElement,
    });
    if (matchedSubscriberIndex !== -1) {
        subscriberList[matchedSubscriberIndex].callback(evt);
    }
}
function findSubscriberIndex(config) {
    var keys = Object.keys(config);
    return subscriberList.findIndex(function (item) {
        return keys.every(function (k) { return item[k] === config[k]; });
    });
}
